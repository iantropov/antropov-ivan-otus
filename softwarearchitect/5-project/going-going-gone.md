# Architectural Kata

## Описание

https://nealford.com/katas/kata?id=GoingGoingGone

**Going...Going...Gone!**

An auction company wants to take their auctions online to a nationwide scale--customers choose the auction to participate in, wait until the auction begins, then bid as if they were there in the room, with the auctioneer

**Users:**

User scale up to hundreds of participants (per auction), potentially up to thousands of participants, and as many simultaneous auctions as possible

**Requirements:**

- auctions must be categorized and 'discoverable'
- auctions must be as real-time as possible
- auctions must be mixed live and online
- video stream of the action after the fact
- handle money exchange
- participants must be tracked via a reputation index

**Additional Context:**

- auction company is expanding aggressively by merging with smaller competitors
- if nationwide auction is a success, replicate the model overseas
- budget is not constrained--this is a strategic direction
- company just exited a lawsuit where they settled a suit alleging fraud

## Решение

### Бизнес-цели и бизнес-драйверы

Создать масштабируемую систему, с которой можно будет выходить на уровень страны и мира.
Проводить аукционы как можно более в реал-тайме

### Стейкхолдеров и их потребности

- Менеджер аукциона (**менеджер**)
- Пользователь системы (**пользователь**)
- Ведущий аукциона (**ведущий**)

### Пользовательские истории

**Сводимые истории:**
- Видео с аукциона
- Проведение аукциона вживую

**Основные истории:**
- Менеджер заводит в системе лот аукциона
- Пользователь регистрируется
- Пользователь ищет нужный аукциона
- Пользователь пополняет кошелёк
- Пользователь пополняет кошелёк (в другой валюте)
- Ведущий запускает аукцион
- Пользователь подключается к аукциону
- Пользователь предлагает цену
- Ведущий закрывает аукцион с продажей
- Ведущий закрывает аукцион без продажи

### Атрибуты качества (и не функциональные требования)

- Система должна обеспечивать онлайн данными пользователей (скорость обновления ~200ms)
- Система должна обеспечивать поддерживать до 100_000 участников одновременных участников в каждом аукционе
- Система должна горизонтально масштабироваться для расширения бизнеса

### Изобразите контекстную схему системы

### Критические сценарии и критические характеристики

1. Менеджер загрузил в систему лот
2. Пользователь зарегистрировался
3. Пользователь пополнил кошелёк
4. Ведущий запустил аукцион
5. Пользователь подключился к аукциону
6. Пользователь сделал ставку
7. Ведущий закрыл аукцион с продажей
8. Ведущий закрыл аукцион без продажи

### Функциональная декомпозиция

- Сервис управления лотами
- Сервис пользователей
- Сервис кошельков
- Сервис истории аукционов
- Сервис аукционов

### Архитектура (сервис аукционов)

Это самый высоконагруженный модуль системы.
Задачи сервиса:
- Инициализировать состояние аукциона при запуске
- Поддерживать своё состояние in-memory
- Поддерживать web-socket соединения со всеми участниками аукциона
- Рассылать изменения в аукционе всем участникам
- Принимать входящих пользователей
- Принимать уведомления от сервиса кошельков о пополнении счёта пользователя
- Поддерживать состояние каждого участника аукциона
- При завершении уведомлять систему о закрытии аукциона
- Выгружать данные из памяти на диск при завершении аукциона

Горячие места сервиса:
- Количество одновременных подключений
- Бюджет на рассылку уведомлений

Для терминирования WS подключений - Lightstreamer
Для in-memory базы - Tarantool

Отказоустойчивость:
- Standby реплика аукциона

Масштабирование:
? Один аукцион - одна нода
- Шардирование клиентов по ID аукциона
- Динамическое поднятие ноды и прибивание по завершению
- Тарантул живой всё время - чтобы была согласованность данных по паралелльным аукционам
- Внутренняя шина сообщений - Kafka (до 10ms)
- Кластер Tarantool
- Каждая нода - Lightstreamer

https://stackoverflow.com/questions/17448061/how-many-system-resources-will-be-held-for-keeping-1-000-000-websocket-open


### Архитектура ()