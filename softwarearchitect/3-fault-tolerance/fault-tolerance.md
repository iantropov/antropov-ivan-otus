# Тактики работы с отказоустойчивостью

## Исследуемые сценарии

1. Запрос в сервис предварительной оценки
   1. Ползователь хочет получить предварительную оценку своей техники
   2. Сервис недоступен
   3. Пользователь периодически повторяет запросы
   4. Сервис поднимается и ложится снова из-за накопленных запросов
   5. Решение: Применяем Circuit Breaker, чтобы в момент старта не положить его снова
2. Запрос на создание заявки пользователя
   1. Пользователь заводит заявку на выкуп техники
   2. Заявка создаётся, но ответ до пользователя не доходит
   3. Пользователь повторяет запрос
   4. Создаётся вторая заявка
   5. Решение: применяем idempotencyId (например, ), чтобы вторая заяка не была создана


## Diagrams:
### 1

https://mermaid.js.org/intro/

Before:

sequenceDiagram
    Пользователь-xСервис: Запрос на оценку
    loop Какой-то интервал
        Пользователь--xСервис: Запрос на оценку
    end

After:
sequenceDiagram
    Пользователь->>Circuit Breaker: Запрос на оценку
    Circuit Breaker-xСервис: Запрос на оценку
    activate Circuit Breaker
    Пользователь->>Circuit Breaker: Запрос на оценку
    Circuit Breaker->>Пользователь: Сервис недоступен
    Пользователь->>Circuit Breaker: Запрос на оценку
    Circuit Breaker->>Пользователь: Сервис недоступен
    Пользователь->>Circuit Breaker: Запрос на оценку
    Circuit Breaker->>Сервис: Запрос на оценку
    Сервис->>Circuit Breaker: Успешный ответ
    Circuit Breaker->>Пользователь: Успешный ответ
    deactivate Circuit Breaker

### 2

Before:

sequenceDiagram
    Пользователь->>Сервис: Создать заявку
    activate Сервис
    Note right of Сервис: Создаётся заявка
    Сервис-xПользователь: Заявка создана
    deactivate Сервис
    Note left of Пользователь: Сетевая ошибка
    Пользователь->>Сервис: Создать заявку
    activate Сервис
    Note right of Сервис: Создаётся дубликат заявки
    Сервис->>Пользователь: Заявка создана
    deactivate Сервис


After:

sequenceDiagram
    Пользователь->>Сервис: Получить requestId
    Сервис->>Пользователь: requestId
    Пользователь->>Сервис: Создать заявку (+requestId)
    activate Сервис
    Note right of Сервис: Создаётся заявка
    Сервис-xПользователь: Заявка создана
    deactivate Сервис
    Note left of Пользователь: Сетевая ошибка
    Пользователь->>Сервис: Создать заявку (+requestId)
    Сервис-xПользователь: requestId уже использован
