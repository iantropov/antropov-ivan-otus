<!DOCTYPE html>
<html class="page" lang="ru">

<head>
    <meta charset="utf-8">
    <title>WebSocket example</title>
</head>

<body class="page__body">
    <h1>Hello, world!</h1>

    <form id="message-form">
        <h2>Choose your message</h2>
        <label>
            Text of a message (type 'finish' to stop the conversation):
            <input id="message" type="text">
            <button>Send</button>
        </label>
    </form>
    <h2>Messages list:</h2>
    <ul id="messages"></ul>

    <script type="text/javascript">
        const myWorker = new Worker('worker.js');
        let areNotificationsAvailable = false;
        if (window.Notification && Notification.permission !== "denied") {
            Notification.requestPermission((status) => {
                areNotificationsAvailable = true;
            })
        } else {
            alert("Notifications aren't available");
        }

        const messageList = document.querySelector('ul');
        window.addEventListener('message', (event) => {
            console.log('[PAGE]: Received from worker');

            const messageElement = document.createElement('li');
            messageElement.textContent = event.data;

            messageList.appendChild(messageElement);
        });

        const form = document.querySelector('form');
        const input = document.querySelector("#message");
        form.addEventListener('submit', (event) => {
            event.preventDefault();
            myWorker.postMessage(input.value);
        });

        myWorker.addEventListener('message', (event) => {
            console.log(`[PAGE]: Received message from worker: ${event.data}`);
            if (areNotificationsAvailable) {
                new Notification(event.data, {
                    body: `Received message from backend: ${event.data}`
                });
            }
        });
    </script>
</body>

</html>